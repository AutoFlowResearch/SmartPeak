version: '1.0.{build}'
image: Visual Studio 2017
environment:
  XercesC_INCLUDE_DIRS: $(WINDOWS_DEPENDENCIES_DIR)\xercesc\build\native\include
  XercesC_LIBRARIES: $(WINDOWS_DEPENDENCIES_DIR)\xercesc\build\native\lib\x64\v110\Release
platform:
  - x64
configuration:
  - Debug
cache:
    - xsd-4.0.msi -> appveyor.yml
install:
    - git submodule update --init --recursive
    - mkdir C:\projects\deps
    - pushd util\install-dep-windows\ && install-dependencies-win.bat & popd
    - dir C:\projects\deps
before_build:
    - echo %CD%
    - mkdir foo
    - echo %CD%
    - ps: cd foo
    - echo %CD%
    - git clone --branch chore/replace_boost_regex https://github.com/biosustain/OpenMS.git C:\projects\OpenMS-build
    - ps: cd C:\projects\OpenMS-build
    - cmake -DXercesC_LIBRARIES:PATH="C:\projects\deps\xsd\lib\vc-12.0\" -DXERCESC_INCLUDE_DIRS:PATH="C:\projects\deps\xsd\include\xercesc" -DBOOST_ROOT=C:\Libraries\boost_1_69_0 -DBOOST_USE_STATIC=OFF -DHAS_XSERVER=OFF -DWITH_GUI=OFF -DENABLE_TUTORIALS=OFF -DENABLE_DOCS=OFF -DGIT_TRACKING=OFF -DENABLE_UPDATE_CHECK=OFF -DCMAKE_BUILD_TYPE=Debug -DPYOPENMS=OFF -DOPENMS_COVERAGE=OFF C:\projects\OpenMS-build
    #- ps: cd C:\projects\smartpeak2
    #- cmake -DEIGEN_USE_GPU=OFF -DUSE_SUPERBUILD=OFF -DBOOST_USE_STATIC=OFF -G "Unix Makefiles" -DCMAKE_PREFIX_PATH=$HOME/OpenMS-build/ -DCMAKE_BUILD_TYPE=Debug
build:
  project: $(APPVEYOR_BUILD_FOLDER)/$(APPVEYOR_PROJECT_NAME).sln